---
title: "Untitled"
author: "Kiera Matiska"
date: "5/6/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(rootSolve)
library(janitor)
library(tibble)
```

```{r}
df <- read_csv("HW3_data.csv") %>% 
  select(-1) %>% 
  clean_names() %>% 
  mutate(msc = 51)
```

## Question 1

```{r}
# 2000 pounds = 1 ton
kWh_ton_co2 <- 0.85/2000 

# MSC is a straight line at $51
msc <- tibble(q_kwh = 0:820000, price_msc = 51)

# Marginal cost function
mc_tibble <- tibble(q_kwh = 0:820000, price = q_kwh * 0.10)

mc_msc <- merge(msc, mc_tibble)

ggplot(mc_msc) +
  geom_line(aes(x = q_kwh, y = price_msc), color = "red") +
  geom_line(aes(x = q_kwh, y = price), color = "blue")
```

## Question 2

```{r}
model_demand_l <- lm(price_cents  ~ q_low_kwh, data=df)
model_demand_h <- lm(price_cents ~ q_high_kwh, data=df)
```

```{r}
# need to rearrange the parameter to get Q(P)! 

# Qgg = Qlow(P) + Qlow(h) 

# Importantly, since they-intercepts are different, we know that Qagg(P) will have a kink. I include an ifelse() statement to take
# care of the kink.

# define a function to get demand

demand <- function(p, model){
  q <- (p - model$coefficients[[1]])/model$coefficients[[2]]
  q <- ifelse(q<0,0,q)
  return(q)
}
```

```{r}
# for each p level, return estimated aggregate demand
demand_agg <- function(p){
  q <- demand(p, model_demand_l) + demand(p, model_demand_h)
  return(q)
}

demand_high <- function(p){
  q <- demand(p, model_demand_h)
  return(q)
}

demand_low <- function(p){
  q <- demand(p, model_demand_l)
  return(q)
}
```

```{r}
price = seq(0, 30, length.out = 100)
Qagg <- map(price, demand_agg) %>% 
  unlist()
Q_high <- map(price, demand_high) %>% 
  unlist()
Q_low <- map(price, demand_low) %>% 
  unlist()

df_agg <- tibble(Qagg = Qagg, price = price, mc_price = 0.10 * Qagg)
df_high <- tibble(Q_high = Q_high, price = price, mc_price = 0.10 * Q_high)
df_low <- tibble(Q_low = Q_low, price = price, mc_price = 0.10 * Q_low)

ggplot() +
  geom_line(data = df_agg, 
            aes(x = Qagg, y = price),
            color = "black") +
  geom_line(data = df_high,
            aes(x = Q_high, y = price),
            color = "red") +
  geom_line(data = df_low,
            aes(x = Q_low, y = price),
            color = "blue")
```



```{r}
# I also define functions for calculating the consumer surplus:

CS <- function(p, model){
  q <- demand(p, model)
  cs <- 0.5*(model$coefficients[[1]] - p)*q
  return(cs)
}

CS_agg <- function(p){
  cs <- CS(p,model_demand_l) + CS(p,model_demand_h)
  return(cs)
}
```













